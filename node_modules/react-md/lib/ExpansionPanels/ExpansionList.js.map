{"version":3,"sources":["../../src/js/ExpansionPanels/ExpansionList.js"],"names":["ExpansionList","state","columnWidths","focusedIndex","overflown","_setContainer","container","_container","window","addEventListener","_determineTabFocus","_width","offsetWidth","_calcColumnWidths","e","which","keyCode","panels","Array","prototype","slice","call","querySelectorAll","setState","indexOf","target","_removeFocus","_isOverflown","widths","panel","querySelector","collapser","collapserWidth","styles","getComputedStyle","maxWidth","parseFloat","paddingLeft","paddingRight","totalWidth","reduce","total","w","_getColumnWidths","maxes","row","columns","i","length","col","style","width","minWidth","Math","max","nextWidths","some","_handleResize","recalculateThreshold","props","abs","animateContent","nextProps","children","prevProps","prevState","removeEventListener","className","Component","component","map","child","key","focused","propTypes","object","string","node","oneOfType","func","isRequired","bool","number","defaultProps","childContextTypes"],"mappings":"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","file":"ExpansionList.js","sourcesContent":["import React, { PureComponent, cloneElement, Children } from 'react';\nimport PropTypes from 'prop-types';\nimport { findDOMNode } from 'react-dom';\nimport cn from 'classnames';\n\nimport { TAB } from '../constants/keyCodes';\nimport handleWindowClickListeners from '../utils/EventUtils/handleWindowClickListeners';\nimport ResizeObserver from '../Helpers/ResizeObserver';\n\n/**\n * The `ExpansionList` component is a wrapper for the `ExpansionPanel` that helps\n * determine which `ExpansionPanel` currently has tab focus and adjusts the column\n * sizes in the header of the `ExpansionPanel`.\n *\n * The `ExpansionList` and `ExpansionPanel` components should have probably been\n * implemented as a `table` instead of a `ul || ol` since it is more column based,\n * but it would complicate the API to have dynamic row generation for the expanded\n * panels. The expanded panels _might_ not follow the same column widths as their labels\n * so a singular row with a div for expanded content might not work correctly.\n */\nexport default class ExpansionList extends PureComponent {\n  static propTypes = {\n    /**\n     * An optional style object to apply to the list.\n     */\n    style: PropTypes.object,\n\n    /**\n     * An optional className to apply to the list.\n     */\n    className: PropTypes.string,\n\n    /**\n     * The children should be a list or singular `ExpansionPanel` component\n     * to render with some additional props injected.\n     */\n    children: PropTypes.node,\n\n    /**\n     * The component to render the list as.\n     */\n    component: PropTypes.oneOfType([\n      PropTypes.string,\n      PropTypes.func,\n    ]).isRequired,\n\n    /**\n     * Boolean if all the expansion panels in the list should animate when their content's visibility\n     * changes. This is just a quicker way to disable all animations instead of having to toggle it off\n     * on each panel.\n     *\n     * > The default value is really `true` since it gets passed down to the `Collapse` component.\n     */\n    animateContent: PropTypes.bool,\n\n    /**\n     * The threshold that should be used for when the list should recalculate the positioning of all\n     * the columns. This will only compare the difference between updates.\n     * So if the size changes from 80 -> 120 -> 160 -> 140. It will only update on the third resize (160)\n     */\n    recalculateThreshold: PropTypes.number.isRequired,\n  };\n\n  static defaultProps = {\n    component: 'ul',\n    recalculateThreshold: 80,\n  };\n\n  static childContextTypes = {\n    animateContent: PropTypes.bool,\n  };\n\n  state = { columnWidths: [], focusedIndex: -1, overflown: false };\n\n  getChildContext() {\n    const { animateContent } = this.props;\n    return { animateContent };\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (this.props.children !== nextProps.children) {\n      this._calcColumnWidths();\n    }\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    const { focusedIndex } = this.state;\n    if (prevState.focusedIndex === focusedIndex || (prevState.focusedIndex > -1 && focusedIndex > -1)) {\n      return;\n    }\n\n    handleWindowClickListeners(this._removeFocus, this.state.focusedIndex !== -1);\n  }\n\n  componentWillUnmount() {\n    if (this.state.focusedIndex === -1) {\n      handleWindowClickListeners(this._removeFocus, false);\n    }\n\n    window.removeEventListener('keyup', this._determineTabFocus);\n  }\n\n  _setContainer = (container) => {\n    if (container !== null) {\n      this._container = findDOMNode(container);\n      window.addEventListener('keyup', this._determineTabFocus);\n\n      this._width = this._container.offsetWidth;\n      this._calcColumnWidths();\n    }\n  };\n\n  _determineTabFocus = (e) => {\n    if ((e.which || e.keyCode) === TAB) {\n      const panels = Array.prototype.slice.call(findDOMNode(this).querySelectorAll('.md-panel-header'));\n      this.setState({ focusedIndex: panels.indexOf(e.target) });\n    }\n  };\n\n  _removeFocus = () => {\n    this.setState({ focusedIndex: -1 });\n  };\n\n  _isOverflown = (widths) => {\n    if (!this._container) {\n      return 0;\n    }\n\n    const panel = this._container.querySelector('.md-panel-header');\n    if (!panel) {\n      return 0;\n    }\n\n    const collapser = this._container.querySelector('.md-expansion-panel__collapser');\n    const collapserWidth = collapser ? collapser.offsetWidth : 0;\n    const styles = window.getComputedStyle(panel);\n    const maxWidth = panel.offsetWidth\n      - parseFloat(styles.paddingLeft)\n      - parseFloat(styles.paddingRight)\n      - collapserWidth;\n\n    const totalWidth = widths.reduce((total, w) => total + w, 0);\n    return totalWidth > maxWidth;\n  };\n\n  /**\n   * Since this should really be rendered as a table, need to calculate the max width for each _column_\n   * on the panel's header and apply that as a min width for the other panels.\n   */\n  _getColumnWidths = () => {\n    if (!this._container) {\n      return this.state.columnWidths;\n    }\n\n    return [].slice.call(this._container.querySelectorAll('.md-panel-header'))\n      .reduce((maxes, row) => {\n        const columns = row.querySelectorAll('.md-panel-column');\n        for (let i = 0; i < columns.length; i++) {\n          const col = columns[i];\n          // Need to reset the widths if it has already been calculated to get a more accurate measurement.\n          const { width, minWidth } = col.style;\n          col.style.width = 'auto';\n          col.style.minWidth = 'auto';\n\n          // Only need to include the offsetWidth of the column because the child will really\n          // determine the width of the column. Since it has already been defined at this point,\n          // no additional work needs to be done.\n          maxes[i] = Math.max(col.offsetWidth, maxes[i] || 0);\n          col.style.width = width;\n          col.style.minWidth = minWidth;\n        }\n\n        return maxes;\n      }, [0]);\n  };\n\n  _calcColumnWidths = () => {\n    const { columnWidths } = this.state;\n    const nextWidths = this._getColumnWidths();\n    const overflown = this._isOverflown(nextWidths);\n    if (this.state.overflown !== overflown\n      || columnWidths.length !== nextWidths.length\n      || nextWidths.some((w, i) => w !== columnWidths[i])\n    ) {\n      this.setState({ columnWidths: nextWidths, overflown });\n    }\n  };\n\n  _handleResize = ({ width }) => {\n    const { recalculateThreshold } = this.props;\n    if (this._width !== width && (Math.abs(width - this._width) >= recalculateThreshold)) {\n      this._width = width;\n      this._calcColumnWidths();\n    }\n  };\n\n  render() {\n    const { columnWidths, focusedIndex, overflown } = this.state;\n    const {\n      children,\n      className,\n      component: Component,\n      animateContent, // eslint-disable-line no-unused-vars\n      recalculateThreshold, // eslint-disable-line no-unused-vars\n      ...props\n    } = this.props;\n\n    const panels = Children.map(children, (child, i) => cloneElement(child, {\n      key: child.key || i,\n      overflown,\n      columnWidths,\n      focused: focusedIndex === i,\n    }));\n    return (\n      <Component\n        {...props}\n        ref={this._setContainer}\n        className={cn('md-expansion-panel-list', className)}\n      >\n        <ResizeObserver watchWidth onResize={this._handleResize} />\n        {panels}\n      </Component>\n    );\n  }\n}\n"]}