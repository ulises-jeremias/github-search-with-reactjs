{"version":3,"sources":["../../../src/js/utils/Positioning/getSelectedTextPosition.js"],"names":["getSelectedTextPosition","ZERO_WIDTH_CHARACTER","e","height","target","clientX","clientY","text","width","Math","round","classList","contains","parseInt","window","getComputedStyle","fontSize","left","top","getSelection","selection","rangeCount","range","getRangeAt","cloneRange","rect","getClientRects","rects","length","span","document","createElement","appendChild","createTextNode","insertNode","getBoundingClientRect","spanParent","parentNode","removeChild","normalize"],"mappings":";;;;;;;;;;;;;;;;;;oBAawBA,uB;;;;;;;;;;;;AAbxB;AAIA,MAAMC,uBAAuB,QAA7B;;AAEA;;;;;;;AAOe,WAASD,uBAAT,CAAiCE,CAAjC,EAAoC;AACjD,QAAIC,eAAJ;AADiD,QAEzCC,MAFyC,GAEZF,CAFY,CAEzCE,MAFyC;AAAA,QAEjCC,OAFiC,GAEZH,CAFY,CAEjCG,OAFiC;AAAA,QAExBC,OAFwB,GAEZJ,CAFY,CAExBI,OAFwB;;AAGjD,QAAMC,OAAO,gCAAb;AACA,QAAMC,QAAQC,KAAKC,KAAL,CAAW,4BAAaH,IAAb,EAAmBH,MAAnB,KAA8B,CAAzC,CAAd;AACA,QAAI,CAACG,IAAD,IAASH,OAAOO,SAAP,CAAiBC,QAAjB,CAA0B,eAA1B,CAAb,EAAyD;AACvDT,eAASU,SAASC,OAAOC,gBAAP,CAAwBX,MAAxB,EAAgCY,QAAzC,EAAmD,EAAnD,CAAT;AACA,aAAO;AACLR,oBADK;AAELL,sBAFK;AAGLc,cAAMZ,UAAUG,KAHX;AAILU,aAAKZ;AAJA,OAAP;AAMD;;AAED;AACA,QAAIQ,OAAOK,YAAX,EAAyB;AACvB,UAAMC,YAAYN,OAAOK,YAAP,EAAlB;AACA,UAAIC,UAAUC,UAAd,EAA0B;AACxB,YAAMC,QAAQF,UAAUG,UAAV,CAAqB,CAArB,EAAwBC,UAAxB,EAAd;AACA,YAAIC,OAAO,IAAX;AACA,YAAIH,MAAMI,cAAV,EAA0B;AACxB,cAAMC,QAAQL,MAAMI,cAAN,EAAd;AACA,cAAIC,MAAMC,MAAN,GAAe,CAAnB,EAAsB;AACpBH,mBAAOE,MAAM,CAAN,CAAP;AACD;AACF;;AAED,YAAI,CAACF,IAAL,EAAW;AACT,cAAMI,OAAOC,SAASC,aAAT,CAAuB,MAAvB,CAAb;AACAF,eAAKG,WAAL,CAAiBF,SAASG,cAAT,CAAwBhC,oBAAxB,CAAjB;AACAqB,gBAAMY,UAAN,CAAiBL,IAAjB;AACAJ,iBAAOI,KAAKM,qBAAL,EAAP;;AAEA,cAAMC,aAAaP,KAAKQ,UAAxB;AACAD,qBAAWE,WAAX,CAAuBT,IAAvB;AACAO,qBAAWG,SAAX;AACD;;AAED,eAAOd,IAAP;AACD;AACF;;AAED,WAAO,IAAP;AACD","file":"getSelectedTextPosition.js","sourcesContent":["/** @module utils/Positoning/getSelectedTextPosition */\nimport getSelectedText from '../getSelectedText';\nimport getTextWidth from './getTextWidth';\n\nconst ZERO_WIDTH_CHARACTER = '\\u200b';\n\n/**\n * A utility function to attempt to get the current highlighted text position.\n *\n * When a context menu is opened, this function attempts to find the bounding client rect\n * for the highlighted text. However, if the text is in the text field, some weird stuff\n * happens and it is unable to get it correctly.\n */\nexport default function getSelectedTextPosition(e) {\n  let height;\n  const { target, clientX, clientY } = e;\n  const text = getSelectedText();\n  const width = Math.round(getTextWidth(text, target) || 0);\n  if (!text || target.classList.contains('md-text-field')) {\n    height = parseInt(window.getComputedStyle(target).fontSize, 10);\n    return {\n      width,\n      height,\n      left: clientX - width,\n      top: clientY,\n    };\n  }\n\n  // All browsers I am supporting have window.getSelection, but better safe than sorry\n  if (window.getSelection) {\n    const selection = window.getSelection();\n    if (selection.rangeCount) {\n      const range = selection.getRangeAt(0).cloneRange();\n      let rect = null;\n      if (range.getClientRects) {\n        const rects = range.getClientRects();\n        if (rects.length > 0) {\n          rect = rects[0];\n        }\n      }\n\n      if (!rect) {\n        const span = document.createElement('span');\n        span.appendChild(document.createTextNode(ZERO_WIDTH_CHARACTER));\n        range.insertNode(span);\n        rect = span.getBoundingClientRect();\n\n        const spanParent = span.parentNode;\n        spanParent.removeChild(span);\n        spanParent.normalize();\n      }\n\n      return rect;\n    }\n  }\n\n  return null;\n}\n"]}